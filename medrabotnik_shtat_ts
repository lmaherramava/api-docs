# Пример минимальной цепочки для работы с ЭПЛ

## Медицинский работник в штате собственника ТС

| **Собственние ТС**                                                                                                                                                                                                                                                                                       | **Оператор ГИС ЭПД**                                                                                                                                                                             |
|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| При формировании титулов ЭПЛ необходимо указывать значение уникального идентификатора документа (УИД) от ГИС ЭПД (атрибут @УИД_ПЛ в xml-документе). Оператор ИС ЭПД запрашивает в ГИС ЭПД пул УИД. В свою очередь, участник информационного взаимодействия (ИВ) запрашивает пул значений УИД у оператора ИС ЭПД, с которым заключено соглашение об электронном документообороте электронных перевозочных документов. Для получения пула УИД вызовите метод /getUuids (количество запрошенных и неиспользованных УИД ограничено - 20 шт.) | При получении Т1 ЭПЛ оператор ИС ЭПД осуществляет проверки УИД, указанного в атрибуте @УИД_ПЛ: УИД принадлежит пулу значений, запрошенному участником информационного взаимодействия; УИД ранее не был использован |
| Для отправки Т1-Т4 ЭПЛ необходимо: сформировать Т1-Т4 ЭПЛ и подписи к ним; каждую пару титула и подписи упаковать в zip-архив (имя архива должно совпадать с именем титула); для каждого титула последовательно вызвать метод /createDocument, в заголовках ответа: doc_id - идентификатор титула ЭПЛ на платформе, container_id - идентификатор ЭПЛ на платформе | После получения подписанных Т1-Т4 ЭПЛ оператор ИС ЭПД направляет титулы в ГИС ЭПД                                                                                                               |
| Для получения статусов обработки Т1-Т4 ЭПЛ необходимо вызвать метод /getDocumentStates, указав в параметрах запроса идентификатор титула ЭПЛ на платформе                                                                                                                                              |                                                                                                                                                                                                   |
| Для получения QR-кода ЭПЛ необходимо вызвать метод /getQrCode, указав в параметрах запроса идентификатор контейнера ЭПЛ на платформе                                                                                                                                                                     | QR-код ЭПЛ может быть запрошен не ранее 1 мин после отправки титулов (при успешной регистрации титулов в ГИС ЭПД)                                                                                 |
| Для отправки Т5 ЭПЛ необходимо: сформировать Т5 ЭПЛ и подпись к нему; титул и подпись упаковать в zip-архив (имя архива должно совпадать с именем титула); вызвать метод /createDocument, в заголовках ответа: doc_id - идентификатор Т5 ЭПЛ на платформе                                                                                       | После получения подписанного Т5 ЭПЛ оператор ИС ЭПД направляет титул в ГИС ЭПД                                                                                                                  |
| Для получения статуса обработки Т5 ЭПЛ необходимо вызвать метод /getDocumentStates, указав в параметрах запроса идентификатор Т5 на платформе                                                                                                                                                          |                                                                                                                                                                                                   |
| Для отправки Т6 ЭПЛ необходимо: сформировать Т6 ЭПЛ и подпись к нему; титул и подпись упаковать в zip-архив (имя архива должно совпадать с именем титула); вызвать метод /createDocument, в заголовках ответа: doc_id - идентификатор Т6 ЭПЛ на платформе                                                                                       | После получения подписанного Т6 ЭПЛ оператор ИС ЭПД направляет титул в ГИС ЭПД                                                                                                                  |
| Для получения статуса обработки Т6 ЭПЛ необходимо вызвать метод /getDocumentStates, указав в параметрах запроса идентификатор Т6 на платформе                                                                                                                                                          |                                                                                                                                                                                                   |



# Пример минимальной цепочки для работы с ЭПЛ

## Медицинский работник в штате собственника ТС

| **Собственние ТС**                                                                                                                                                                         | **Оператор ГИС ЭПД**                                                                                                                      |
|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------------------------------------------------------------------------------------------------------------|
| **1. Формирование титулов ЭПЛ**: Укажите значение уникального идентификатора документа (УИД) от ГИС ЭПД (атрибут `@УИД_ПЛ` в XML-документе). Для получения пула УИД вызовите метод `/getUuids` (до 20 УИД за раз). | Проверяет, что УИД принадлежит пулу значений, запрошенному участником взаимодействия, и ранее не использовался.                           |
| **2. Отправка Т1–Т4 ЭПЛ**: Сформируйте титулы и подписи, упакуйте их в ZIP-архив (имя архива должно совпадать с именем титула). Вызовите метод `/createDocument`. | После получения подписанных Т1–Т4 ЭПЛ направляет титулы в ГИС ЭПД.                                                                       |
| **3. Получение статусов Т1–Т4 ЭПЛ**: Вызовите метод `/getDocumentStates`, указав идентификатор титула.                                                                                    |                                                                                                                                            |
| **4. Запрос QR-кода ЭПЛ**: Используйте метод `/getQrCode` с параметром `идентификатор контейнера`. Запрашивайте не ранее чем через 1 минуту после успешной отправки титулов.             | QR-код ЭПЛ доступен только после успешной регистрации титулов в ГИС ЭПД.                                                                  |
| **5. Отправка Т5 ЭПЛ**: Сформируйте титул и подпись, упакуйте их в ZIP-архив, вызовите метод `/createDocument`.                                                                           | После получения подписанного Т5 ЭПЛ направляет титул в ГИС ЭПД.                                                                           |
| **6. Получение статуса Т5 ЭПЛ**: Используйте метод `/getDocumentStates`, указав идентификатор титула.                                                                                     |                                                                                                                                            |
| **7. Отправка Т6 ЭПЛ**: Сформируйте титул и подпись, упакуйте их в ZIP-архив, вызовите метод `/createDocument`.                                                                           | После получения подписанного Т6 ЭПЛ направляет титул в ГИС ЭПД.                                                                           |
| **8. Получение статуса Т6 ЭПЛ**: Вызовите метод `/getDocumentStates`, указав идентификатор титула.                                                                                        |                                                                                                                                            |

```mermaid
sequenceDiagram
    participant Собственник ТС
    participant Оператор ИС ЭПД

    Собственник ТС->>Оператор ИС ЭПД: Формирование титулов ЭПЛ (запрос УИД через /getUuids)
    Оператор ИС ЭПД-->>Собственник ТС: Проверка УИД

    Собственник ТС->>Оператор ИС ЭПД: Отправка Т1–Т4 ЭПЛ (/createDocument)
    Оператор ИС ЭПД-->>Собственник ТС: Передача титулов в ГИС ЭПД

    Собственник ТС->>Оператор ИС ЭПД: Получение статусов Т1–Т4 (/getDocumentStates)

    Собственник ТС->>Оператор ИС ЭПД: Запрос QR-кода ЭПЛ (/getQrCode)
    Оператор ИС ЭПД-->>Собственник ТС: Передача QR-кода (после успешной регистрации титулов)

    Собственник ТС->>Оператор ИС ЭПД: Отправка Т5 ЭПЛ (/createDocument)
    Оператор ИС ЭПД-->>Собственник ТС: Передает Т5 титул в ГИС ЭПД

    Собственник ТС->>Оператор ИС ЭПД:  Получение статуса Т5 (/getDocumentStates)

    Собственник ТС->>Оператор ИС ЭПД:  Отправка Т6 ЭПЛ (/createDocument)
    Оператор ИС ЭПД-->>Собственник ТС: Передает Т6 титул в ГИС ЭПД

    Собственник ТС->>Оператор ИС ЭПД:  Получение статуса Т6 (/getDocumentStates)
```
